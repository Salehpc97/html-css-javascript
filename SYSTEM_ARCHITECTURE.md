
# نظرة عامة على بنية النظام

يقدم هذا المستند شرحًا تفصيليًا لبنية المشروع، موضحًا كيفية تفاعل الواجهة الخلفية (Backend) مع الواجهة الأمامية (Frontend)، بالإضافة إلى شرح المكونات المختلفة لكل جزء.

## 1. الهيكل العام

يعتمد المشروع على بنية **العميل-الخادم (Client-Server)**:

- **الخادم (Backend):** مسؤول عن تقديم الملفات الثابتة (HTML, CSS, JS) وتوفير واجهة برمجية (API) لجلب بيانات الكتب.
- **العميل (Frontend):** واجهة المستخدم التي يتفاعل معها المستخدمون، وهي مسؤولة عن عرض البيانات والتفاعل مع الخادم.

---

## 2. الواجهة الخلفية (Backend)

يتم تشغيل الواجهة الخلفية بواسطة ملف واحد.

### `backend/server.js`

هذا الملف هو نقطة الدخول الوحيدة للخادم، ويقوم بالمهام التالية:

- **الإطار المستخدم:** Express.js.
- **المنفذ (Port):** يعمل الخادم على `http://localhost:3000`.
- **تقديم الملفات الثابتة:** يقوم الخادم بتقديم جميع الملفات الموجودة في مجلد `public` بشكل ثابت. هذا يعني أن أي ملف داخل `public` (مثل `index.html`, `Library.html`, وملفات `assets`) يمكن الوصول إليه مباشرة عبر المتصفح.
- **واجهة جلب الكتب (API):**
  - **المسار:** `GET /api`
  - **الوظيفة:** عند طلب هذا المسار، يقوم الخادم بقراءة ملف `public/books/metadata.json` الذي يحتوي على بيانات جميع الكتب، ثم يعيدها كاستجابة بصيغة JSON. هذا هو المصدر الوحيد للبيانات الديناميكية في التطبيق.

**مثال على تدفق البيانات في الواجهة الخلفية:**
1.  الواجهة الأمامية تطلب `http://localhost:3000/api`.
2.  `server.js` يستقبل الطلب.
3.  يقرأ محتوى `public/books/metadata.json`.
4.  يرسل المحتوى كاستجابة JSON إلى الواجهة الأمامية.

---

## 3. الواجهة الأمامية (Frontend)

تنقسم الواجهة الأمامية إلى جزأين رئيسيين، لكل منهما طريقته في العمل:

### أ. صفحة المكتبة (البنية البسيطة)

هذه البنية تُستخدم في صفحة `Library.html` وتعتمد على ملف واحد لإدارة كل شيء.

- **الملفات الرئيسية:**
  - `public/Library.html`: هيكل الصفحة.
  - `public/assets/css/Library.css`: الأنماط والتصميم.
  - `public/assets/js/LibraryLogic.js`: المنطق البرمجي الكامل للصفحة.

- **آلية العمل:**
  1.  عند فتح `Library.html`، يتم تحميل `LibraryLogic.js`.
  2.  يقوم `LibraryLogic.js` بإرسال طلب `fetch` إلى `http://localhost:3000/api` لجلب بيانات الكتب.
  3.  بعد استلام البيانات، يقوم بتخزينها في متغير `booksData`.
  4.  يتم عرض الكتب ديناميكيًا في الصفحة عبر تعديل DOM (إنشاء كروت الكتب).
  5.  يحتوي الملف أيضًا على منطق البحث، وتصفية الفئات، وعرض التفاصيل في نافذة منبثقة (Modal)، وكلها تعمل من جانب العميل (Client-Side) عن طريق معالجة مصفوفة `booksData`.

### ب. التطبيق الرئيسي (البنية المتقدمة المبنية على الوحدات)

هذه البنية تُستخدم في صفحة `index.html` وهي أكثر تنظيمًا وقابلية للتوسع.

- **الملفات الرئيسية:**
  - `public/index.html`: هيكل الصفحة.
  - `public/assets/js/main.js`: نقطة الدخول الرئيسية للتطبيق.
  - **مجلد `public/assets/js/core`:** يحتوي على "نواة" التطبيق:
    - `core-config.js`: ملفات الإعدادات.
    - `core-domManager.js`: أدوات للتحكم في عناصر الصفحة (DOM).
    - `core-eventBus.js`: نظام مركزي لتبادل الأحداث بين الوحدات المختلفة (Publish/Subscribe).
    - `core-state.js`: لإدارة حالة التطبيق (مثل قائمة الكتب، حالة التحميل، الأخطاء).
    - `core-index.js`: يجمع كل وحدات النواة في مكان واحد.
  - **مجلد `public/assets/js/services`:** يحتوي على "خدمات" منفصلة للمهام المتخصصة:
    - `services-apiService.js`: مسؤول عن جميع الاتصالات مع الواجهة الخلفية (API).
    - `services-bookService.js`: مسؤول عن العمليات المتعلقة بالكتب (مثل البحث، التصفية، الإحصائيات).

- **آلية العمل:**
  1.  عند فتح `index.html`، يتم تحميل `main.js` (يجب أن يكون من نوع `module`).
  2.  يقوم `main.js` بإنشاء كائن `DigitalLibraryApp`.
  3.  يبدأ الكائن بتهيئة النظام على مراحل: النواة (`core`) ثم الخدمات (`services`).
  4.  يستخدم `eventBus` لطلب جلب الكتب.
  5.  `services-apiService.js` يقوم بالطلب الفعلي للخادم.
  6.  `services-bookService.js` يعالج البيانات المستلمة.
  7.  `core-state.js` يخزن البيانات.
  8.  يتم تحديث واجهة المستخدم بناءً على التغييرات في الحالة.

---

## 4. ملخص الترابط بين الملفات

- **`server.js`** يخدم كل الملفات الموجودة في `public` ويوفر بيانات الكتب عبر `/api`.
- **`Library.html`** ← يستخدم `Library.css` و `LibraryLogic.js`.
- **`LibraryLogic.js`** ← يتصل بـ `/api` لجلب الكتب.
- **`index.html`** ← يستخدم `main.js` (كوحدة).
- **`main.js`** ← ينسق بين `core` و `services`.
- **`services-apiService.js`** ← يتصل بـ `/api`.
- **`services-bookService.js`** ← يستخدم البيانات من `core-state.js` لتنفيذ عمليات على الكتب.
- **`core-state.js`** ← يحتفظ بحالة التطبيق (البيانات).
- **ملفات `*.html`** الأخرى (مثل `Login.html`, `Register.html`) تبدو وكأنها جزء من نظام مصادقة لم يتم ربطه بالواجهة الخلفية الحالية (`server.js`).
